## 浅谈DNS（二）DNS服务器的实现



### DNS服务器-----分布式数据库的杰出案例

1. 让我们先放开细节性的东西（如DNS的报文结构，从哪个端口输出......), 从宏观上来分析如何使用DNS。主机host想要访问某一个网址，因此发出DNS查询报文，DNS服务器接受这个报文，然后返回hostname对应的IP地址，主机host接受这个报文，并访问对应的IP地址。**这就是DNS请求和响应的简易过程。**
2. **最容易想到的DNS服务器的设计方式**就是仅设立一个DNS中心服务器，它用来响应所有的DNS请求，并且进行响应。但这样会带来几个问题：
   1. **a single point of failure**.如果这个DNS服务器崩溃，那么整个internet都会陷入困境。
   2. **traffic volum** . 单个DNS服务器不得不处理全球数十亿主机产生的HTTP请求。
   3. **distant centralized database**.单中心的数据库一定会离某些地方比较近，一些地方比较远。在上海的数据库如果要响应来自本地的请求一般意义上一定比来自伦敦的请求快。
   4. **maintenance**.服务器不得不频繁的更新来应对主机域名和IP的改动和添加，减少。
3. **因此DNS服务器采取分布式，层次布局**。
   1. **根DNS服务器**。
   2. **顶级域名服务器**。负责顶级域名如com，org，net，edu，gov，uk，cn
   3. **权威域名服务器**。具有公共可访问主机的组织机构提供公共可访问的DNS记录（hostname：IP）。
   4. **本地域名服务器**。严格来讲，本地服务器并不属于DNS层次结构，但十分重要。**它起到代理的作用**。每一个ISP都有一台本地服务器，当你的主机连接到相应ISP时，其会提供本地DNS服务器的IP地址（或地址集，如果有多个服务器的话），你发送和DNS请求会由本地DNS服务器代为向DNS层次服务器请求并返回响应。

### 例子---DNS查询

![](C:\Users\15052\Desktop\DNS.jpg)

**过程如下**。

	1. cis.poly.edu 想要访问gaia.cs.umass.edu.
 	2. DNS请求报文发往本地DNS服务器（step1）
 	3. 本地服务器将请求访问根服务器。（step2）
 	4. 根服务器根据edu的结尾返回负责edu顶级域名的TLD DNS服务器（step3）
 	5. 本地服务器发送查询报文给TLD DNS服务器。（step4）
 	6. 顶级域名服务器根据umass.edu返回权威域名服务器IP地址。（step5）
 	7. 本地服务器根据TLD返回，发送查询报文到权威域名服务器。（step6）
 	8. 权威域名服务器返回对应IP地址。（step7）
 	9. 本地服务器返回IP地址。

### DNS缓存

- 由上面的例子知道，每次查询所花费的时间和资源实在是太多了。而缓存技术，可以有效改善性能。相信读者对于缓存技术已经有一定了解了，故此不多赘述。**只提一点，由于域名和IP对应变化比较频繁，所以DNS记录在服务器里存在时间有限，一段时间后将丢弃缓存信息。**

